<!DOCTYPE html>
<html lang="en">

<!-- Head -->
<th:block th:replace="~{includes/anon/head}" />

<body id="page-top">

<!-- Page Wrapper -->
<div id="wrapper">

    <!-- Sidebar -->
    <th:block th:replace="~{includes/anon/sidebar}" />

    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">

        <!-- Main Content -->
        <div id="content">

            <!-- Topper -->
            <th:block th:replace="~{includes/anon/topper}" />

            <!-- Begin Page Content -->
            <div class="container-fluid">

                <!-- Page Heading -->
                <h1 class="h3 mb-4 text-gray-800">Blank Page</h1>

                <div class="form-group row">
                    <div class="col-sm-8">
                        <textarea type="text" class="input_param form-control" id="anon_post_content" name="content" placeholder="Talk freely!"></textarea>
                    </div>
                </div>

                <div class="form-group row mt-6">
                    <div class="col-sm-8 offset-sm-8 text-end">
                        <button class="btn btn-primary m-1" id="create_post_btn" onclick="create_post()">Post</button>
                        <button class="btn btn-secondary m-1" id="list_post_btn" onclick="list_post()">List</button>
                    </div>
                </div>

                <div id="anon_post_list">
                </div>

            </div>
            <!-- /.container-fluid -->

        </div>
        <!-- End of Main Content -->


        <!-- Footer -->
        <th:block th:replace="~{includes/anon/footer}" />

    </div>
    <!-- End of Content Wrapper -->

</div>
<!-- End of Page Wrapper -->

<!-- Scroll to Top Button-->
<a class="scroll-to-top rounded" href="#page-top">
    <i class="fas fa-angle-up"></i>
</a>

<!-- Logout Modal-->
<th:block th:replace="~{includes/anon/logout}" />

<!-- Script-->
<th:block th:replace="~{includes/anon/script}" />

<script>
    function create_post() {
        $.ajax({
            url: "/api/anonPost",
            method: "POST",
            contentType: 'application/json; charset=utf-8',
            headers:{
                "Authorization" : localStorage.getItem("Authorization")
            },
            data:JSON.stringify({
                content: $('#anon_post_content').val()
            }),
            success: (data, status, xhr)=>{
                alert(JSON.stringify(data));
                list_notice();
            },
            error: (data, status, xhr)=>{
                alert(JSON.stringify(data));
            }
        });
    }

    function list_post() {
        $.ajax({
            url: "/api/anonPost/list",
            method: "GET",
            contentType : 'application/json; charset=utf-8',
            headers:{
                "Authorization" : localStorage.getItem("Authorization")
            },
            success: (data, status, xhr)=>{
                alert(JSON.stringify(data));
                $("#anon_post_list").html("");
                for(let each of data){
                    alert(JSON.stringify(each["content"]));
                    $("#anon_post_list").append("<div class='anon_post' id='anon_post_" + each["id"] + "'>"
                        + "Content:" + each["content"]
                        + "ModifiedAt:" + each["modifiedAt"]
                        + "</div>");
                }
            },
            error: (data, status, xhr)=>{
                alert(JSON.stringify(data));
            }
        });
    }
</script>

</body>

</html>